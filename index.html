<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Klasifikační hra</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
        .container {
            max-width: 900px;
        }
        .card {
            background-color: white;
            padding: 2.5rem;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .button {
            transition: transform 0.1s ease-in-out, box-shadow 0.1s ease-in-out;
            cursor: pointer;
        }
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .correct {
            background-color: #d1fae5;
            color: #065f46;
        }
        .incorrect {
            background-color: #fee2e2;
            color: #991b1b;
        }
        .message-box {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4 sm:p-8">

    <div id="game-container" class="container mx-auto">
        <!-- Úvodní obrazovka -->
        <div id="start-screen" class="card text-center transition-opacity duration-500">
            <h1 class="text-3xl sm:text-4xl font-bold mb-4">Klasifikační hra</h1>
            <p class="mb-6 text-gray-600">Otestuj si své znalosti klasifikace organismů. Tato hra má 4 kola, ve kterých budeš spojovat organismy s jejich třídou a řádem a nakonec je i psát.</p>
            <button onclick="startGame()" class="button bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-full text-lg">
                Spustit hru
            </button>
        </div>

        <!-- Herní obrazovka -->
        <div id="game-screen" class="card hidden">
            <h2 id="round-title" class="text-2xl sm:text-3xl font-bold mb-4 text-center"></h2>
            <div id="species-info" class="text-center mb-6">
                <h3 id="species-name" class="text-xl sm:text-2xl font-semibold text-blue-800 mb-2"></h3>
                <p id="species-description" class="text-gray-600 italic"></p>
            </div>
            
            <div id="question-area" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <!-- Tlačítka pro volbu nebo textové pole se objeví zde -->
            </div>

            <div id="feedback-message" class="message-box text-center p-4 mt-6 rounded-lg text-lg font-semibold hidden"></div>
            
            <div class="flex justify-center mt-6">
                <button id="next-button" onclick="nextQuestion()" class="button bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-full hidden">
                    Pokračovat
                </button>
            </div>
        </div>

        <!-- Závěrečná obrazovka -->
        <div id="end-screen" class="card text-center hidden transition-opacity duration-500">
            <h2 class="text-3xl sm:text-4xl font-bold mb-4">Konec hry!</h2>
            <p id="final-score" class="text-xl mb-6 text-gray-700"></p>
            <p class="mb-6 text-gray-600">Děkuji, že sis zahrál/a. Můžeš zkusit hrát znovu a zlepšit si skóre!</p>
            <button onclick="restartGame()" class="button bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-full text-lg">
                Hrát znovu
            </button>
        </div>
    </div>

    <script>
        // Data o organismech
        const organisms = [
            {
                speciesName: "Liška obecná",
                description: "Všežravá psovitá šelma s většinou rezavě hnědou srstí a hustým ocasem. Je jedním z nejrozšířenějších savců na světě.",
                class: "Savci (Mammalia)",
                order: "Šelmy (Carnivora)"
            },
            {
                speciesName: "Kapr obecný",
                description: "Sladkovodní ryba s šupinami a vousky kolem úst. Je hospodářsky významný a velmi rozšířený v rybnících.",
                class: "Paprskoploutvé ryby (Actinopterygii)",
                order: "Máloostní (Cypriniformes)"
            },
            {
                speciesName: "Sýkora koňadra",
                description: "Drobný pták s výrazným žlutým bříškem a svislým černým pruhem. Patří mezi nejběžnější ptáky v České republice.",
                class: "Ptáci (Aves)",
                order: "Pěvci (Passeriformes)"
            },
            {
                speciesName: "Užovka obojková",
                description: "Mírně jedovatý had s charakteristickým žlutým nebo oranžovým obojkem za hlavou. Obývá vlhká místa a často plave.",
                class: "Plazi (Reptilia)",
                order: "Šupinatí (Squamata)"
            },
            {
                speciesName: "Rosnička zelená",
                description: "Drobná žába s jasně zelenou kůží a přísavkami na prstech. Je aktivní v noci a často ji lze slyšet, jak skřehotá.",
                class: "Obojživelníci (Amphibia)",
                order: "Žáby (Anura)"
            },
            {
                speciesName: "Veverka obecná",
                description: "Malý hlodavec s dlouhým huňatým ocasem. Je známá sběrem a uskladňováním potravy, zejména ořechů a semen.",
                class: "Savci (Mammalia)",
                order: "Hlodavci (Rodentia)"
            },
            {
                speciesName: "Poštolka obecná",
                description: "Malý denní dravec z čeledi sokolovitých. Je proslulá svým třepotavým letem na místě, kterým vyhledává kořist.",
                class: "Ptáci (Aves)",
                order: "Sokoli (Falconiformes)"
            },
            {
                speciesName: "Roháč obecný",
                description: "Jeden z největších brouků v Evropě. Samečci mají nápadně velká rohatá kusadla, která připomínají paroží.",
                class: "Hmyz (Insecta)",
                order: "Brouci (Coleoptera)"
            },
            {
                speciesName: "Mravenec lesní",
                description: "Sociální hmyz žijící ve velkých koloniích, které staví vysoké mraveniště. Jsou důležití pro ekosystém lesa.",
                class: "Hmyz (Insecta)",
                order: "Blanokřídlí (Hymenoptera)"
            },
            {
                speciesName: "Ještěrka obecná",
                description: "Malý plaz s tenkým tělem a dlouhým ocasem. V případě ohrožení ho dokáže odhodit a nechat dorůst.",
                class: "Plazi (Reptilia)",
                order: "Šupinatí (Squamata)"
            }
        ];

        // Seřazení organismů náhodně
        organisms.sort(() => Math.random() - 0.5);

        // Herní stav
        let currentRound = 1;
        let currentQuestionIndex = 0;
        let score = 0;

        // Elementy UI
        const startScreen = document.getElementById('start-screen');
        const gameScreen = document.getElementById('game-screen');
        const endScreen = document.getElementById('end-screen');
        const roundTitle = document.getElementById('round-title');
        const speciesNameEl = document.getElementById('species-name');
        const speciesDescriptionEl = document.getElementById('species-description');
        const questionArea = document.getElementById('question-area');
        const feedbackMessage = document.getElementById('feedback-message');
        const nextButton = document.getElementById('next-button');
        const finalScoreEl = document.getElementById('final-score');

        // Funkce pro start hry
        function startGame() {
            startScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            gameScreen.classList.add('opacity-0');
            setTimeout(() => gameScreen.classList.remove('opacity-0'), 100);
            resetGame();
            loadQuestion();
        }

        // Funkce pro restart hry
        function restartGame() {
            endScreen.classList.add('hidden');
            startScreen.classList.remove('hidden');
            startScreen.classList.add('opacity-0');
            setTimeout(() => startScreen.classList.remove('opacity-0'), 100);
            // Resetuje pořadí organismů pro novou hru
            organisms.sort(() => Math.random() - 0.5);
        }

        // Funkce pro reset herního stavu
        function resetGame() {
            currentRound = 1;
            currentQuestionIndex = 0;
            score = 0;
        }

        // Funkce pro načtení další otázky
        function nextQuestion() {
            currentQuestionIndex++;
            feedbackMessage.classList.add('hidden');
            nextButton.classList.add('hidden');
            questionArea.innerHTML = '';

            if (currentQuestionIndex >= organisms.length) {
                currentQuestionIndex = 0;
                currentRound++;
                if (currentRound > 4) {
                    showEndScreen();
                    return;
                }
            }
            loadQuestion();
        }

        // Funkce pro zobrazení závěrečné obrazovky
        function showEndScreen() {
            gameScreen.classList.add('hidden');
            endScreen.classList.remove('hidden');
            endScreen.classList.add('opacity-0');
            setTimeout(() => endScreen.classList.remove('opacity-0'), 100);
            finalScoreEl.textContent = `Tvoje celkové skóre je ${score} z ${organisms.length * 4}.`;
        }

        // Funkce pro načtení otázky podle aktuálního kola
        function loadQuestion() {
            const organism = organisms[currentQuestionIndex];
            
            // Nastavení prvků UI pro každé kolo
            if (currentRound === 1) {
                speciesNameEl.textContent = "";
                speciesDescriptionEl.textContent = "";
                roundTitle.textContent = "Kolo 1: Přiřaď popis k organismu";
                loadRound1();
            } else if (currentRound === 2) {
                speciesNameEl.textContent = organism.speciesName;
                speciesDescriptionEl.textContent = ""; // Popis odebrán
                roundTitle.textContent = "Kolo 2: Přiřaď třídu";
                loadRound2();
            } else if (currentRound === 3) {
                speciesNameEl.textContent = organism.speciesName;
                speciesDescriptionEl.textContent = ""; // Popis odebrán
                roundTitle.textContent = "Kolo 3: Přiřaď řád";
                loadRound3();
            } else if (currentRound === 4) {
                speciesNameEl.textContent = "";
                speciesDescriptionEl.textContent = "";
                roundTitle.textContent = `Kolo 4: Napiš název organismu (z dnes představených) pro třídu ${organism.class.split(' (')[0]} a řád ${organism.order.split(' (')[0]}.`;
                loadRound4();
            }
        }
        
        // Kolo 1: Výběr správného organismu (původní kolo 3)
        function loadRound1() {
            const currentOrganism = organisms[currentQuestionIndex];
            speciesNameEl.textContent = "Řád: " + currentOrganism.order.split(' (')[0];
            speciesDescriptionEl.textContent = currentOrganism.description;

            const allOrganisms = [...organisms];
            allOrganisms.sort(() => Math.random() - 0.5);

            allOrganisms.forEach(org => {
                const button = document.createElement('button');
                button.textContent = org.speciesName;
                button.className = "button w-full bg-gray-200 hover:bg-gray-300 py-3 px-4 rounded-full font-semibold";
                button.onclick = () => checkAnswerRound1(button, org.speciesName, currentOrganism.speciesName);
                questionArea.appendChild(button);
            });
        }

        // Kolo 2: Výběr třídy (původní kolo 1)
        function loadRound2() {
            const classes = [...new Set(organisms.map(o => o.class))];
            classes.sort(() => Math.random() - 0.5);

            classes.forEach(cls => {
                const button = document.createElement('button');
                button.textContent = cls;
                button.className = "button w-full bg-gray-200 hover:bg-gray-300 py-3 px-4 rounded-full font-semibold";
                button.onclick = () => checkAnswerRound2(button, cls);
                questionArea.appendChild(button);
            });
        }

        // Kolo 3: Výběr řádu (původní kolo 2)
        function loadRound3() {
            const orders = [...new Set(organisms.map(o => o.order))];
            orders.sort(() => Math.random() - 0.5);

            orders.forEach(ord => {
                const button = document.createElement('button');
                button.textContent = ord;
                button.className = "button w-full bg-gray-200 hover:bg-gray-300 py-3 px-4 rounded-full font-semibold";
                button.onclick = () => checkAnswerRound3(button, ord);
                questionArea.appendChild(button);
            });
        }

        // Kolo 4: Napiš název organismu (původní kolo 4)
        function loadRound4() {
            const inputGroup = document.createElement('div');
            inputGroup.className = "flex flex-col sm:flex-row gap-4";
            
            const input = document.createElement('input');
            input.type = "text";
            input.id = "species-input";
            input.placeholder = "Napište zde název organismu...";
            input.className = "w-full p-3 rounded-full border-2 border-gray-300 focus:outline-none focus:border-blue-500";
            
            const submitButton = document.createElement('button');
            submitButton.textContent = "Zkontrolovat";
            submitButton.className = "button bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-full";
            submitButton.onclick = () => checkAnswerRound4();
            
            inputGroup.appendChild(input);
            inputGroup.appendChild(submitButton);
            questionArea.appendChild(inputGroup);
        }

        // Kontrola odpovědi - Kolo 1
        function checkAnswerRound1(button, selectedName, correctName) {
            const isCorrect = selectedName === correctName;
            
            if (isCorrect) {
                score += 1;
                feedbackMessage.textContent = "Správně! Získáváš 1 bod.";
                feedbackMessage.className = "message-box correct text-center p-4 mt-6 rounded-lg text-lg font-semibold";
            } else {
                feedbackMessage.textContent = `Špatně. Správná odpověď je ${correctName}.`;
                feedbackMessage.className = "message-box incorrect text-center p-4 mt-6 rounded-lg text-lg font-semibold";
            }
            
            feedbackMessage.classList.remove('hidden');
            nextButton.classList.remove('hidden');
            disableButtons();
        }

        // Kontrola odpovědi - Kolo 2
        function checkAnswerRound2(button, selectedClass) {
            const organism = organisms[currentQuestionIndex];
            const isCorrect = selectedClass === organism.class;
            
            if (isCorrect) {
                score += 1;
                feedbackMessage.textContent = "Správně! Získáváš 1 bod.";
                feedbackMessage.className = "message-box correct text-center p-4 mt-6 rounded-lg text-lg font-semibold";
            } else {
                feedbackMessage.textContent = `Špatně. Správná odpověď je ${organism.class}.`;
                feedbackMessage.className = "message-box incorrect text-center p-4 mt-6 rounded-lg text-lg font-semibold";
            }
            
            feedbackMessage.classList.remove('hidden');
            nextButton.classList.remove('hidden');
            disableButtons();
        }

        // Kontrola odpovědi - Kolo 3
        function checkAnswerRound3(button, selectedOrder) {
            const organism = organisms[currentQuestionIndex];
            const isCorrect = selectedOrder === organism.order;
            
            if (isCorrect) {
                score += 1;
                feedbackMessage.textContent = "Správně! Získáváš 1 bod.";
                feedbackMessage.className = "message-box correct text-center p-4 mt-6 rounded-lg text-lg font-semibold";
            } else {
                feedbackMessage.textContent = `Špatně. Správná odpověď je ${organism.order}.`;
                feedbackMessage.className = "message-box incorrect text-center p-4 mt-6 rounded-lg text-lg font-semibold";
            }
            
            feedbackMessage.classList.remove('hidden');
            nextButton.classList.remove('hidden');
            disableButtons();
        }

        // Kontrola odpovědi - Kolo 4
        function checkAnswerRound4() {
            const organism = organisms[currentQuestionIndex];
            const userInput = document.getElementById('species-input').value.trim();
            let gainedScore = 0;
            let feedbackText = "";
            let isFullScore = false;

            const normalizedUserInput = userInput.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");

            // Kontrola pro Plazy/Šupinaté
            if (organism.class === "Plazi (Reptilia)" && organism.order === "Šupinatí (Squamata)") {
                const correctNormalizedNames = ["uzovka obojkova", "jesterka obecna"];
                
                if (correctNormalizedNames.includes(normalizedUserInput)) {
                    gainedScore = 1;
                    isFullScore = true;
                    feedbackText = `Skvěle! Správně jsi napsal/a jeden z možných názvů. Získáváš 1 bod.`;
                } else {
                    let hasPartialMatch = false;
                    const correctWords1 = correctNormalizedNames[0].split(' ');
                    const correctWords2 = correctNormalizedNames[1].split(' ');
                    const userWords = normalizedUserInput.split(' ');

                    for (let word of userWords) {
                        if (correctWords1.includes(word) || correctWords2.includes(word)) {
                            hasPartialMatch = true;
                            break;
                        }
                    }

                    if (hasPartialMatch) {
                        gainedScore = 0.5;
                        feedbackText = `Částečně správně. Získáváš 0,5 bodu. Správné názvy jsou: Užovka obojková nebo Ještěrka obecná.`;
                    } else {
                        gainedScore = 0;
                        feedbackText = `Bohužel, tvá odpověď není správná. Správné názvy jsou: Užovka obojková nebo Ještěrka obecná.`;
                    }
                }
            } else {
                // Původní logika pro ostatní organismy
                const correctNormalizedName = organism.speciesName.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                const correctWords = correctNormalizedName.split(' ');

                if (normalizedUserInput === correctNormalizedName) {
                    gainedScore = 1;
                    isFullScore = true;
                    feedbackText = `Skvěle! Správně jsi napsal/a rodový i druhový název. Získáváš 1 bod.`;
                } else {
                    const userWords = normalizedUserInput.split(' ');
                    const hasGenus = userWords.includes(correctWords[0]);
                    const hasSpecies = correctWords.length > 1 ? userWords.includes(correctWords[1]) : false;

                    if (hasGenus || hasSpecies) {
                        gainedScore = 0.5;
                        feedbackText = `Správně jsi napsal/a ${hasGenus ? "rodový" : "druhový"} název. Získáváš 0,5 bodu. Správný název je: ${organism.speciesName}.`;
                    } else {
                        gainedScore = 0;
                        feedbackText = `Bohužel, tvá odpověď není správná. Správný název je: ${organism.speciesName}.`;
                    }
                }
            }
            
            score += gainedScore;

            feedbackMessage.textContent = feedbackText;
            feedbackMessage.className = isFullScore ? "message-box correct text-center p-4 mt-6 rounded-lg text-lg font-semibold" : "message-box incorrect text-center p-4 mt-6 rounded-lg text-lg font-semibold";
            feedbackMessage.classList.remove('hidden');
            nextButton.classList.remove('hidden');
        }

        // Funkce pro zakázání tlačítek po výběru
        function disableButtons() {
            const buttons = questionArea.querySelectorAll('button');
            buttons.forEach(button => {
                button.disabled = true;
            });
        }
    </script>
</body>
</html>
